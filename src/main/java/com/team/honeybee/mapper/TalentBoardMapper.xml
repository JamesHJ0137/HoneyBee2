<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.team.honeybee.mapper.TalentBoardMapper">
	<!-- 게시물 리스트 가져오기 -->
	<select id="findOrder" resultType="com.team.honeybee.domain.TalentBoardDto">
		SELECT t.title,
				t.talent_id talentId,
				t.price,
				m.nickname,
				bi.main_image_name MPhoto,
				bi.image_folder_id folderName,
				tr.star_rating starRating
		FROM Talent t LEFT JOIN Member m ON t.member_id = m.member_id
					  LEFT JOIN BoardImage bi ON t.talent_id = bi.talent_id
					  LEFT JOIN TalentReview tr ON tr.talent_id = t.talent_id
		WHERE bi.main_image_name IS NOT NULL
		GROUP BY t.talent_id
		ORDER BY t.talent_id DESC 
	</select>
	
	<!-- 특정 게시물 정보 가져오기 -->
	<select id="getBoard" resultType="com.team.honeybee.domain.TalentBoardDto">
		SELECT  t.talent_id talentId,
		      	t.title, 
				t.content,
				t.price, 
				t.topic, 
				t.map_level mapLevel, 
				t.address,
				t.product_name productName,
				m.nickname,
				bi.main_image_name MPhoto,
				bi.image_folder_id folderName,
				tr.star_rating starRating
		FROM Talent t LEFT JOIN Member m ON t.member_id = m.member_id
					  LEFT JOIN BoardImage bi ON t.talent_id = bi.talent_id
					  LEFT JOIN TalentReview tr ON tr.talent_id = t.talent_id
		WHERE t.talent_id = #{talentId} AND bi.main_image_name IS NOT NULL;
	</select>
	

	
	<!-- 게시물 쓰기 -->
	<insert  useGeneratedKeys="true"  id="setTalentBoard" parameterType="com.team.honeybee.domain.TalentBoardDto"
				keyColumn="talent_id" keyProperty="talentId">
		INSERT INTO Talent(member_id, 
							title, 
							content,
							 price, 
							 product_name,
							 work_date,
							 number_people,
							 expired, 
							 topic,
							 map_level,
							 address,
							 work_date,
							 number_of_people,
							 self_introduction)
		VALUES (#{memberId}, 
				#{title}, 
				#{content}, 
				#{price}, 
				#{productName},
				#{workDate},
				#{numberOfPeople},
				#{expired}, 
				#{topic},
				#{mapLevel},
				#{address},
				#{workDate},
				#{numberOfPeople},
				#{selfIntroduction})
	</insert>
	<insert id="insertMainPhoto">
		INSERT INTO BoardImage(talent_id, main_image_name, member_id, image_folder_id)
		VALUES(#{talentId}, #{mainPhoto}, #{memberId}, #{folderName})
	</insert>


	

</mapper>	